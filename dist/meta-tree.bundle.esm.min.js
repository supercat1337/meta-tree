var h=class{name;attributes=new Map;isOptional=!1;defaultValue;description;constructor(t,e=!1,r=null,s=null){this.name=t,this.isOptional=e,this.defaultValue=r,this.description=s}hasAttribute(t){return this.attributes.has(t)}getAttribute(t){return this.attributes.get(t)||null}deleteAttribute(t){this.attributes.delete(t)}setAttribute(t,e){this.attributes.set(t,e)}#t(){return Array.from(this.attributes.entries()).map(([t,e])=>{if(e){let r=e.replace(/"/g,'\\"').replace(/'/g,"\\'").replace(/\r?\n/g,"\\n");return`${t}="${r}"`}return t}).join(" ")}#e(){return this.description?("// "+this.description.replace(/"/g,"&quot;").replace(/\r?\n/g,"\\n")).trim():""}stringify(){let t=this.isOptional?`[${this.name}="${this.defaultValue}"]`:this.name,e=this.#t(),r=this.#e();return`${t}    ${e} ${r}`.trim()}toJSON(){return{name:this.name,isOptional:this.isOptional,defaultValue:this.defaultValue,description:this.description,attributes:Array.from(this.attributes.entries())}}};var c=class{name;fields=new Map;constructor(t){if(/\s/.test(t))throw new Error(`Section name cannot contain spaces: ${t}`);if(t.length===0)throw new Error("Section name cannot be empty");this.name=t}addField(t){if(this.hasField(t.name))throw new Error(`Field already exists: ${t.name}`);this.fields.set(t.name,t)}hasField(t){return this.fields.has(t)}getField(t){let e=this.fields.get(t);return e||null}setField(t){this.fields.set(t.name,t)}deleteField(t){this.fields.delete(t)}getFields(){return Array.from(this.fields.values())}stringify(t="    "){let e=[];this.fields.forEach(s=>{e.push(s.stringify())});let r=e.map(s=>t+s).join(`
`);return this.name=="main"?`${r}
`:`${t+"@"+this.name}
${r}
`}toJSON(){return{name:this.name,fields:Array.from(this.fields.values()).map(t=>t.toJSON())}}};function p(i){return i===null||!i?null:(i=i.trim(),i.startsWith("get")?"get":i.startsWith("set")?"set":i.startsWith("add")?"add":i.startsWith("delete")?"delete":i.startsWith("list")?"list":(i.startsWith("check"),"check"))}var d=class{entityName;propertyName;actionName;verb;sections;mainSection;description;constructor(t,e,r=null,s=null){if(this.entityName=t,this.propertyName=e,this.actionName=r,this.verb=p(r),/\s/.test(t))throw new Error(`Entity name cannot contain spaces: ${t}`);if(t.length===0)throw new Error("Entity name cannot be empty");if(e&&/\s/.test(e))throw new Error(`Property name cannot contain spaces: ${e}`);if(e&&e.length===0)throw new Error("Property name cannot be empty");this.sections=new Map,this.mainSection=new c("main"),this.sections.set("main",this.mainSection),this.description=s}getFullName(){let t=this.entityName;return this.propertyName&&(t+="."+this.propertyName),this.actionName&&(t+="."+this.actionName),t}addSection(t){if(this.sections.has(t))throw new Error(`Section already exists: ${t}`);let e=new c(t);return this.sections.set(t,e),e}getSection(t){return this.sections.get(t)||null}deleteSection(t){this.sections.delete(t)}hasSection(t){return this.sections.has(t)}setSection(t){this.sections.set(t.name,t)}getSections(){return Array.from(this.sections.values())}addField(t,e="main"){let r=this.sections.get(e);r||(r=this.addSection(e)),r.addField(t)}getField(t,e="main"){let r=this.sections.get(e);return r?r.getField(t):null}hasField(t,e="main"){let r=this.sections.get(e);return r?r.hasField(t):!1}setField(t,e="main"){let r=this.sections.get(e);r||(r=this.addSection(e)),r.setField(t)}deleteField(t,e="main"){let r=this.sections.get(e);if(!r)return null;r.deleteField(t)}getFields(t="main"){let e=this.sections.get(t);return e?e.getFields():null}#t(){return this.description?("// "+this.description.replace(/"/g,"&quot;").replace(/\r?\n/g,"\\n")).trim():""}stringify(){let t=[],e=this.getFullName(),r=this.#t();t.push(`${e}    ${r}`.trim());for(let s of this.sections.values())t.push(s.stringify());return t.join(`
`)}toJSON(){return{name:this.getFullName(),entityName:this.entityName,propertyName:this.propertyName,actionName:this.actionName,verb:this.verb,description:this.description,sections:Array.from(this.sections.values()).map(t=>t.toJSON())}}};var f=class{records=new Map;constructor(){}addRecord(t,e=null,r=null,s=null){let l=new d(t,e,r,s),n=l.getFullName();if(this.records.has(n))throw new Error(`Record already exists: ${n}`);return this.records.set(n,l),l}hasRecord(t){return this.records.has(t)}getRecord(t){return this.records.get(t)||null}deleteRecord(t){this.records.delete(t)}getRecords(){return Array.from(this.records.values())}setRecord(t){this.records.set(t.getFullName(),t)}getRecordNames(){return Array.from(this.records.keys())}stringify(){return Array.from(this.records.values()).map(t=>t.stringify()).join(`

`)}toJSON(){return{records:Array.from(this.records.values()).map(t=>t.toJSON())}}};function b(i){return!/^\s/.test(i)&&!y(i)}function y(i){return i.startsWith("@")}function $(i){i=i.trim();let t=i.split(/\s+/)[0],e=i.split(/\/\//)[1]?.trim(),r=typeof e>"u"?null:e,s=t.split("."),l=s[0],n=null,o=null;return s.shift(),s.length>0&&(o=s[s.length-1],s.pop()),s.length>0&&(n=s.join(".")),{entityName:l,propertyName:n,actionName:o,description:r}}function N(i){let t=i.match(/^@([\w_\.]+)/);return t?t[1]:null}function g(i){let t={},e=null,r=/(\$?[^\s=]+)(?:\s*=\s*("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|\$?[^\s]*)|$)?/g,s;for(;(s=r.exec(i))!==null;){let l=s[1];if(l.startsWith("//")){e=s.input.slice(s.index+2).trim(),e==""&&(e=null);break}let n=s[2],o=null;n&&(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'")?o=n.slice(1,-1).replace(/\\(["'])/g,"$1"):o=n),t[l]=o}return{attributes:t,comment:e}}function A(i){let t=null,e=!1,r=null,s="",l=null;if(i.startsWith("[")){let a=i.indexOf("]");if(a===-1)throw new Error(`Invalid field: ${i}`);let u=i.slice(1,a),{attributes:w}=g(u),[F,S]=Object.entries(w)[0];t=F,e=!0,r=S,s=i.slice(a+1).trim()}else{let a=i.match(/^([a-zA-Z0-9_\.]+)/);if(t=a?a[1]:null,!t)throw new Error(`Invalid field: ${i}`);e=i[t.length]==="?",s=i.slice(t.length+(e?1:0)).trim()}let n=new h(t,e,r),{attributes:o,comment:m}=g(s);for(let[a,u]of Object.entries(o))n.setAttribute(a,u);return n.description=m,n}function x(i){let t=new f,e=i.split(`
`),r=null,s="main";for(let l of e){if(l.trim()==="")continue;if(b(l)){let{entityName:o,propertyName:m,actionName:a,description:u}=$(l);r=t.addRecord(o,m,a,u),s="main";continue}if(r===null)continue;if(l=l.trim(),y(l)){let o=N(l);if(!o)continue;r.addSection(o),s=o;continue}if(l==="")continue;let n=A(l);r.addField(n,s)}return t}export{h as Field,d as Record,c as Section,f as Tree,x as treeFromString};
